<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Этнографическая викторина</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .score-board {
            font-size: 24px;
            margin: 20px;
            color: #2c3e50;
        }
        .timer {
            width: 200px;
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            margin: 20px;
            overflow: hidden;
        }
        .timer-progress {
            height: 100%;
            background: #27ae60;
            width: 100%;
            transition: width 1s linear;
        }
        .question-images {
            display: flex;
            gap: 20px;
            margin: 20px;
            max-height: 300px;
        }
        .question-images img {
            height: 300px;
            object-fit: cover;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }
        .answers {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .answer-option {
            width: 200px;
            height: 200px;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 10px;
            overflow: hidden;
            transition: 0.3s;
        }
        .answer-option:hover {
            transform: scale(1.05);
            border-color: #3498db;
        }
        .answer-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .question-text {
            font-size: 24px;
            margin: 20px;
            color: #34495e;
        }
    </style>
</head>
<body>
    <div class="score-board">Баллы: <span id="score">50</span></div>
    <div class="timer">
        <div class="timer-progress" id="timer"></div>
    </div>
    <div class="question-images" id="questionImages"></div>
    <div class="question-text">Какая территория у этого этноса?</div>
    <div class="answers" id="answers"></div>

    <script>
        let currentData = [];
        let score = 50;
        let timerId;
        let timeLeft;
        const questionTime = 30;

        // Загрузка данных
        fetch('data.csv')
            .then(response => response.text())
            .then(data => {
                currentData = data.split('\n')
                    .map(row => {
                        const [name, img1, img2, extra, correctImg] = row.split(';');
                        return {img1, img2, correctImg};
                    })
                    .filter(item => item.img1 && item.img2 && item.correctImg)
                    .sort(() => Math.random() - 0.5);
                startNewRound();
            });

        function startNewRound() {
            // Сброс таймера
            clearInterval(timerId);
            timeLeft = questionTime;
            document.getElementById('timer').style.width = '100%';

            // Выбор текущего вопроса
            const currentItem = currentData.shift();
            if(!currentItem) return endGame();

            // Отображение вопроса
            document.getElementById('questionImages').innerHTML = `
                <img src="faces/${currentItem.img1}">
                <img src="faces/${currentItem.img2}">
            `;

// Создание вариантов ответов
    const answers = [currentItem.correctImg];
    
    // Создаем копию всех данных исключая текущий элемент
    const otherItems = [...currentData.filter(item => item.correctImg !== currentItem.correctImg)];
    
    // Выбираем 2 уникальных случайных ответа из ДРУГИХ категорий
    const wrongAnswers = [];
    while(wrongAnswers.length < 2 && otherItems.length > 0) {
        const randomIndex = Math.floor(Math.random() * otherItems.length);
        const candidate = otherItems.splice(randomIndex, 1)[0].correctImg;
        if(!answers.includes(candidate) && !wrongAnswers.includes(candidate)) {
            wrongAnswers.push(candidate);
        }
    }
    
    answers.push(...wrongAnswers);
    
    // Если не хватило уникальных - добираем из любых
    while(answers.length < 3) {
        const randomItem = currentData[Math.floor(Math.random() * currentData.length)];
        if(!answers.includes(randomItem.correctImg)) {
            answers.push(randomItem.correctImg);
        }
    }
            answers.sort(() => Math.random() - 0.5);

            // Отрисовка ответов
            document.getElementById('answers').innerHTML = answers.map(img => `
                <div class="answer-option" onclick="checkAnswer('${img}', '${currentItem.correctImg}')">
                    <img src="m/${img}">
                </div>
            `).join('');

            // Запуск таймера
            timerId = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').style.width = `${(timeLeft/questionTime)*100}%`;
                
                if(timeLeft <= 0) {
                    handleAnswer(false);
                }
            }, 1000);
        }

        function checkAnswer(selected, correct) {
            handleAnswer(selected === correct);
        }

        function handleAnswer(isCorrect) {
            clearInterval(timerId);
            const points = isCorrect ? 30 + timeLeft : -30;
            score += points;
            document.getElementById('score').textContent = score;
            
            alert(isCorrect ? 
                `Правильно! +${30 + timeLeft} баллов` : 
                `Ошибка! -30 баллов`);
            
            if(score <= 0) {
                endGame();
                return;
            }
            
            setTimeout(startNewRound, 1500);
        }

        function endGame() {
            alert(`Игра окончена! Ваш счет: ${score}`);
            location.reload();
        }
    </script>
</body>
</html>